{% extends 'base.html' %} 
{% load static %} 
{% load blog_filters %}
{% block content %}


    <!-- **************** MAIN CONTENT START **************** -->
    <main>
        
<!-- =======================
Page Banner START -->
<section class="py-5">
	<div class="container">
		<div class="row position-relative">
		
			<!-- Title and breadcrumb -->
			<div class="col-lg-10 mx-auto text-center position-relative">
				
				<figure class="position-absolute top-100 start-50 translate-middle mt-3 ms-n9 d-none d-lg-block">
					<svg style="transform: scale(-1,1)">
						<path class="fill-success"
							d="m181.6 6.7c-0.1 0-0.2-0.1-0.3 0-2.5-0.3-4.9-1-7.3-1.4-2.7-0.4-5.5-0.7-8.2-0.8-1.4-0.1-2.8-0.1-4.1-0.1-0.5 0-0.9-0.1-1.4-0.2-0.9-0.3-1.9-0.1-2.8-0.1-5.4 0.2-10.8 0.6-16.1 1.4-2.7 0.3-5.3 0.8-7.9 1.3-0.6 0.1-1.1 0.3-1.8 0.3-0.4 0-0.7-0.1-1.1-0.1-1.5 0-3 0.7-4.3 1.2-3 1-6 2.4-8.8 3.9-2.1 1.1-4 2.4-5.9 3.9-1 0.7-1.8 1.5-2.7 2.2-0.5 0.4-1.1 0.5-1.5 0.9s-0.7 0.8-1.1 1.2c-1 1-1.9 2-2.9 2.9-0.4 0.3-0.8 0.5-1.2 0.5-1.3-0.1-2.7-0.4-3.9-0.6-0.7-0.1-1.2 0-1.8 0-3.1 0-6.4-0.1-9.5 0.4-1.7 0.3-3.4 0.5-5.1 0.7-5.3 0.7-10.7 1.4-15.8 3.1-4.6 1.6-8.9 3.8-13.1 6.3-2.1 1.2-4.2 2.5-6.2 3.9-0.9 0.6-1.7 0.9-2.6 1.2s-1.7 1-2.5 1.6c-1.5 1.1-3 2.1-4.6 3.2-1.2 0.9-2.7 1.7-3.9 2.7-1 0.8-2.2 1.5-3.2 2.2-1.1 0.7-2.2 1.5-3.3 2.3-0.8 0.5-1.7 0.9-2.5 1.5-0.9 0.8-1.9 1.5-2.9 2.2 0.1-0.6 0.3-1.2 0.4-1.9 0.3-1.7 0.2-3.6 0-5.3-0.1-0.9-0.3-1.7-0.8-2.4s-1.5-1.1-2.3-0.8c-0.2 0-0.3 0.1-0.4 0.3s-0.1 0.4-0.1 0.6c0.3 3.6 0.2 7.2-0.7 10.7-0.5 2.2-1.5 4.5-2.7 6.4-0.6 0.9-1.4 1.7-2 2.6s-1.5 1.6-2.3 2.3c-0.2 0.2-0.5 0.4-0.6 0.7s0 0.7 0.1 1.1c0.2 0.8 0.6 1.6 1.3 1.8 0.5 0.1 0.9-0.1 1.3-0.3 0.9-0.4 1.8-0.8 2.7-1.2 0.4-0.2 0.7-0.3 1.1-0.6 1.8-1 3.8-1.7 5.8-2.3 4.3-1.1 9-1.1 13.3 0.1 0.2 0.1 0.4 0.1 0.6 0.1 0.7-0.1 0.9-1 0.6-1.6-0.4-0.6-1-0.9-1.7-1.2-2.5-1.1-4.9-2.1-7.5-2.7-0.6-0.2-1.3-0.3-2-0.4-0.3-0.1-0.5 0-0.8-0.1s-0.9 0-1.1-0.1-0.3 0-0.3-0.2c0-0.4 0.7-0.7 1-0.8 0.5-0.3 1-0.7 1.5-1l5.4-3.6c0.4-0.2 0.6-0.6 1-0.9 1.2-0.9 2.8-1.3 4-2.2 0.4-0.3 0.9-0.6 1.3-0.9l2.7-1.8c1-0.6 2.2-1.2 3.2-1.8 0.9-0.5 1.9-0.8 2.7-1.6 0.9-0.8 2.2-1.4 3.2-2 1.2-0.7 2.3-1.4 3.5-2.1 4.1-2.5 8.2-4.9 12.7-6.6 5.2-1.9 10.6-3.4 16.2-4 5.4-0.6 10.8-0.3 16.2-0.5h0.5c1.4-0.1 2.3-0.1 1.7 1.7-1.4 4.5 1.3 7.5 4.3 10 3.4 2.9 7 5.7 11.3 7.1 4.8 1.6 9.6 3.8 14.9 2.7 3-0.6 6.5-4 6.8-6.4 0.2-1.7 0.1-3.3-0.3-4.9-0.4-1.4-1-3-2.2-3.9-0.9-0.6-1.6-1.6-2.4-2.4-0.9-0.8-1.9-1.7-2.9-2.3-2.1-1.4-4.2-2.6-6.5-3.5-3.2-1.3-6.6-2.2-10-3-0.8-0.2-1.6-0.4-2.5-0.5-0.2 0-1.3-0.1-1.3-0.3-0.1-0.2 0.3-0.4 0.5-0.6 0.9-0.8 1.8-1.5 2.7-2.2 1.9-1.4 3.8-2.8 5.8-3.9 2.1-1.2 4.3-2.3 6.6-3.2 1.2-0.4 2.3-0.8 3.6-1 0.6-0.2 1.2-0.2 1.8-0.4 0.4-0.1 0.7-0.3 1.1-0.5 1.2-0.5 2.7-0.5 3.9-0.8 1.3-0.2 2.7-0.4 4.1-0.7 2.7-0.4 5.5-0.8 8.2-1.1 3.3-0.4 6.7-0.7 10-1 7.7-0.6 15.3-0.3 23 1.3 4.2 0.9 8.3 1.9 12.3 3.6 1.2 0.5 2.3 1.1 3.5 1.5 0.7 0.2 1.3 0.7 1.8 1.1 0.7 0.6 1.5 1.1 2.3 1.7 0.2 0.2 0.6 0.3 0.8 0.2 0.1-0.1 0.1-0.2 0.2-0.4 0.1-0.9-0.2-1.7-0.7-2.4-0.4-0.6-1-1.4-1.6-1.9-0.8-0.7-2-1.1-2.9-1.6-1-0.5-2-0.9-3.1-1.3-2.5-1.1-5.2-2-7.8-2.8-1-0.8-2.4-1.2-3.7-1.4zm-64.4 25.8c4.7 1.3 10.3 3.3 14.6 7.9 0.9 1 2.4 1.8 1.8 3.5-0.6 1.6-2.2 1.5-3.6 1.7-4.9 0.8-9.4-1.2-13.6-2.9-4.5-1.7-8.8-4.3-11.9-8.3-0.5-0.6-1-1.4-1.1-2.2 0-0.3 0-0.6-0.1-0.9s-0.2-0.6 0.1-0.9c0.2-0.2 0.5-0.2 0.8-0.2 2.3-0.1 4.7 0 7.1 0.4 0.9 0.1 1.6 0.6 2.5 0.8 1.1 0.4 2.3 0.8 3.4 1.1z">
						</path>
					</svg>
				</figure>

				<!-- Title -->
				<h1 class="fs-2">وبلاگ</h1>
				<!-- Breadcrumb -->
				<div class="d-flex justify-content-center position-relative">
					<nav aria-label="breadcrumb">
						<ol class="breadcrumb mb-0">
							<li class="breadcrumb-item"><a href="/">صفحه اصلی</a></li>
							<li class="breadcrumb-item"><a href="{% url 'blog:blog' %}">وبلاگ</a></li>
							{% if search_query %}
							<li class="breadcrumb-item active" aria-current="page">نتایج جستجو: "{{ search_query }}"</li>
							{% endif %}
						</ol>
					</nav>
				</div>
			</div>
		</div>
	</div>
</section>
<!-- =======================
Page Banner END -->

<!-- =======================
Page content START -->
<section class="py-5">
	<div class="container">

		<div class="row">

			<div class="col-lg-8 pt-5 pt-lg-0">
				<div class="row mb-4 align-items-center">
					
					<!-- Search bar -->
					<div class="col-md-6">
						<div class="input-group search-box mb-3">
							<input type="text" class="form-control custom-search-input" placeholder="جستجو وبلاگ ..." aria-label="جستجو وبلاگ" aria-describedby="button-search">
							<button class="btn btn-primary search-btn" type="button" id="button-search">
								<i class="fas fa-search"></i> جستجو
							</button>
						</div>
					</div>

					<!-- Select option -->
					<div class="col-md-6">
						<div class="input-group sort-box mb-3">
							<label class="input-group-text sort-label" for="inputGroupSort">
								<i class="fas fa-sort-amount-down"></i>
							</label>
							<select class="form-select custom-sort-select" id="inputGroupSort">
								<option value="">مرتب سازی</option>
								<option value="1">جدیدترین</option>
								<option value="2">قدیمی ترین</option>
								<option value="3">پربازدیدترین</option>
							</select>
						</div>
					</div>

					<!-- Content -->
					<div class="col-12 col-xl-3 d-flex justify-content-between align-items-center mt-3 mt-xl-0">

						<!-- Advanced filter responsive toggler START -->
						<button class="btn btn-outline-primary mb-0 filter-btn d-lg-none" type="button" data-bs-toggle="offcanvas"
							data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar">
							<i class="fas fa-sliders-h me-1"></i> نمایش فیلتر
						</button>
						<!-- Advanced filter responsive toggler END -->
						
						<!-- تعداد نتایج با پیام مناسب - نسخه ساده شده -->
						<div class="mb-0 text-end result-count">
							<span class="badge bg-primary rounded-pill me-1">{{all_posts_count}}</span>
							{% if search_query or selected_category or selected_tag %}
                                نتیجه  
                                {% if all_posts_count != total_posts_count %}(از {{total_posts_count}} مطلب){% endif %}
							{% else %}
								مطلب
							{% endif %}
						</div>
					</div>

				</div>
				<div class="row g-4">
					
					<!-- Card item START -->
					 {% for post in posts %}
					<div class="col-12">
						<div class="card bg-transparent shadow h-100 transition-hover border-0 hover-translate-y {% if post.is_login_required %}locked-post{% endif %}">
							<div class="row g-0">
								<div class="col-lg-4">
									<div class="overflow-hidden rounded-start h-100">
										<img src="{% if post.image %}{{post.image.url}}{% else %} {% static 'images/blog/default-blog.jpg' %} {% endif %}" class="card-img-start h-100 w-100" alt="{{post.title}}" loading="lazy" style="object-fit: cover;">
										<!-- Overlay -->
										<div class="bg-overlay bg-dark opacity-2"></div>
										<div class="card-img-overlay d-flex align-items-start p-3">
											<!-- badge -->
											<div class="category-badges">
												{% for category in post.category.all %}
												<a href="/blog/?category={{category.name}}" class="badge text-bg-danger fw-bold me-1">{{category.name}}</a>
												{% empty %}
												<span class="badge text-bg-secondary fw-bold">بدون دسته</span>
												{% endfor %}
											</div>
										</div>
									</div>
								</div>
								<div class="col-lg-8">
									<!-- Card body -->
									<div class="card-body p-4 h-100 d-flex flex-column">
										<!-- Title -->
										<h4 class="card-title fw-semi-bold mb-3">
											<a class="text-decoration-none stretched-link" href="{% if post.slug %}{% url 'blog:blog_single' post.slug %}{% else %}#{% endif %}">
												{{post.title}}
												{% if post.is_login_required %}
												<span class="lock-icon-wrapper ms-2" title="این مطلب فقط برای کاربران ثبت‌نام شده قابل مشاهده است">
												    <i class="fas fa-lock text-warning lock-icon"></i>
												</span>
												{% endif %}
											</a>
										</h4>
										{% if post.is_login_required and not user.is_authenticated %}
											<p class="text-truncate-3 mb-3">{{ post.content_preview|clean_text_excerpt:100 }}</p>
										{% else %}
											<p class="text-truncate-3 mb-3">{{post.content|clean_text_excerpt:100}}</p>
										{% endif %}
										<!-- Info -->
										<div class="d-flex justify-content-between align-items-center border-top pt-3 mt-auto">
											<h6 class="mb-0 fw-normal"><a href="#" class="text-reset"><i class="fas fa-user-circle me-1 text-primary"></i>نویدیار</a>
											</h6>
											<span class="small me-2"><i class="far fa-calendar-alt text-secondary me-1"></i>{{post.created_at|date:"Y/m/d"}}</span>
											<span class="small"><i class="fas fa-eye text-secondary me-1"></i>{{post.count_views}}</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					{% empty %}
					<div class="col-12">
						<div class="alert alert-info text-center p-4">
							<i class="fas fa-info-circle fa-2x mb-3"></i>
							<h4>نتیجه‌ای یافت نشد!</h4>
							{% if search_query %}
							<p>هیچ نتیجه‌ای برای جستجوی "<strong>{{ search_query }}</strong>" یافت نشد.</p>
							<a href="{% url 'blog:blog' %}" class="btn btn-primary mt-3">
								<i class="fas fa-redo me-2"></i>بازگشت به همه مطالب
							</a>
							{% else %}
							<p>در حال حاضر مطلبی برای نمایش وجود ندارد.</p>
							{% endif %}
						</div>
					</div>
					{% endfor %}
					<!-- Card item END -->
				
					
				
				</div>
				
<!-- Pagination START -->
<nav class="d-flex justify-content-center mt-5" aria-label="navigation">
    <ul class="pagination pagination-primary-soft rounded mb-0">
        
        <!-- صفحه قبلی -->
        {% if posts.has_previous %}
        <li class="page-item mb-0">
            <button class="page-link" onclick="changePage(`{{ posts.previous_page_number }}`)">
                <i class="fas fa-angle-double-right"></i>
            </button>
        </li>
        {% endif %}
        
        <!-- شماره صفحات -->
        {% if posts.paginator.num_pages > 0 %}
            {% if posts.paginator.num_pages <= 5 %}
                <!-- اگر تعداد صفحات کمتر از 5 باشد، همه را نمایش بده -->
                {% for i in posts.paginator.page_range %}
                    {% if posts.number == i %}
                        <li class="page-item mb-0 active"><a class="page-link" href="#">{{ i }}</a></li>
                    {% else %}
                        <li class="page-item mb-0">
                            <button class="page-link" onclick="changePage(`{{ i }}`)">{{ i }}</button>
                        </li>
                    {% endif %}
                {% endfor %}
            {% else %}
                <!-- نمایش محدود صفحات (تنها 5 صفحه حول صفحه جاری) -->
                {% if posts.number > 3 %}
                    <li class="page-item mb-0">
                        <button class="page-link" onclick="changePage(`1`)">1</button>
                    </li>
                    {% if posts.number > 4 %}
                        <li class="page-item mb-0 disabled"><span class="page-link">...</span></li>
                    {% endif %}
                {% endif %}
                
                {% for i in posts.paginator.page_range %}
                    {% if posts.number|add:'-2' <= i and i <= posts.number|add:'2' %}
                        {% if posts.number == i %}
                            <li class="page-item mb-0 active"><a class="page-link" href="#">{{ i }}</a></li>
                        {% else %}
                            <li class="page-item mb-0">
                                <button class="page-link" onclick="changePage(`{{ i }}`)">{{ i }}</button>
                            </li>
                        {% endif %}
                    {% endif %}
                {% endfor %}
                
                {% if posts.number < posts.paginator.num_pages|add:'-2' %}
                    {% if posts.number < posts.paginator.num_pages|add:'-3' %}
                        <li class="page-item mb-0 disabled"><span class="page-link">...</span></li>
                    {% endif %}
                    <li class="page-item mb-0">
                        <button class="page-link" onclick="changePage(`{{ posts.paginator.num_pages }}`)">{{ posts.paginator.num_pages }}</button>
                    </li>
                {% endif %}
            {% endif %}
        {% endif %}
        
        <!-- صفحه بعدی -->
        {% if posts.has_next %}
        <li class="page-item mb-0">
            <button class="page-link" onclick="changePage(`{{ posts.next_page_number }}`)">
                <i class="fas fa-angle-double-left"></i>
            </button>
        </li>
        {% endif %}
        
    </ul>
</nav>
<!-- Pagination END -->
			</div>
			<div class="col-lg-4 pt-5 pt-lg-0">
				<div class="col-md-6 col-lg-12 mb-3">
					<!-- Responsive offcanvas body START -->
					<div class="offcanvas-lg offcanvas-end" tabindex="-1" id="offcanvasSidebar">
						<div class="offcanvas-body p-3 p-lg-0">
							<div class="offcanvas-header bg-light">
								<h5 class="offcanvas-title" id="offcanvasNavbarLabel">جستجوی پیشرفته</h5>
								<button type="button" class="btn-close" data-bs-dismiss="offcanvas"
									data-bs-target="#offcanvasSidebar" aria-label="Close"></button>
							</div>
						

						</div>

					</div>
					<!-- Responsive offcanvas body END -->
				</div>
				
				<div class="col-md-6 col-xl-12  pb-4">
					
				{% include 'blog/blog-side.html' %}   

				</div>

               
				
			</div>
</section>
<!-- =======================
Page content END -->


    </main>


    <!-- Back to top -->
    <div class="back-top"><i class="fas fa-arrow-up position-absolute top-50 start-50 translate-middle"></i></div>

    <script src="{% static 'CACHE/js/output.8d126b85d939.js' %}"></script>
    
    <!-- اضافه کردن اسکریپت جستجو و مرتب‌سازی -->
    <script src="{% static 'js/blog.js' %}"></script>



</body>



</html>
{% endblock %}
<style>
.hover-translate-y {
    transition: all 0.3s ease-in-out;
}
.hover-translate-y:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.15) !important;
}
.transition-hover {
    transition: all 0.3s ease;
}
.fw-semi-bold {
    font-weight: 600;
}
.card-img {
    height: 200px;
    object-fit: cover;
}
.text-truncate-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    min-height: 48px;
}
.text-truncate-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* استایل برای پست‌های قفل شده */
.lock-icon-wrapper {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-right: 5px;
    vertical-align: middle;
}

.lock-icon {
    color: #f7971e;
    font-size: 16px;
}

/* استایل پس‌زمینه طلایی برای کارت‌های قفل‌شده */
.card.locked-post {
    background: linear-gradient(to bottom, rgba(255,245,220,0.7) 0%, rgba(255,255,255,1) 70%) !important;
    border-right: 3px solid #f7971e !important;
}

/* حالت تاریک برای کارت‌های قفل‌شده */
@media (prefers-color-scheme: dark) {
    .card.locked-post {
        background: linear-gradient(to bottom, rgba(80,60,10,0.3) 0%, rgba(40,40,40,0.1) 70%) !important;
        border-right: 3px solid #f7971e !important;
    }
}

/* استایل برای بخش جستجو و مرتب‌سازی */
.search-box, .sort-box {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.search-box:focus-within, .sort-box:focus-within {
    box-shadow: 0 8px 16px rgba(0,0,0,0.12);
    transform: translateY(-2px);
}

.custom-search-input, .custom-sort-select {
    border: none;
    padding: 12px 16px;
    font-size: 1rem;
    height: auto;
}

.custom-search-input:focus, .custom-sort-select:focus {
    box-shadow: none;
}

.search-btn {
    padding: 0 24px;
    border-radius: 0;
    font-weight: 500;
}

.sort-label {
    background-color: #f8f9fa;
    border: none;
    color: #6c757d;
}

.filter-btn {
    border-radius: 10px;
    padding: 8px 16px;
    font-weight: 500;
}

.result-count {
    font-weight: 500;
    white-space: nowrap !important;
    font-size: 0.95rem;
    display: inline-flex !important;
    flex-wrap: nowrap !important;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
}

.result-count .badge {
    padding: 6px 10px;
    margin-left: 6px;
    flex-shrink: 0;
}

/* استایل برای دسته‌بندی‌ها */
.category-link {
    color: var(--bs-light);
    transition: all 0.3s ease;
    font-weight: 500;
    display: inline-block;
    padding: 3px 0;
}

.category-link:hover {
    color: var(--bs-primary);
    transform: translateX(5px);
}

.category-link.active {
    color: var(--bs-primary);
    font-weight: 700;
}



</style>
