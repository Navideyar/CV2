{% extends 'base.html' %} {% load static %} {% block title %}<title>
  تماس با نویدیار | ارتباط با ما</title
>{% endblock %} {% block content %}

<!-- **************** MAIN CONTENT START **************** -->
<main>
  <!-- =======================
Image and contact form START -->
  <section>
    <div class="container">
      <div class="row g-4 g-lg-0 align-items-center">
        <div class="col-md-6 align-items-center text-center">
          <!-- Image -->
          <img
            src="/static/images/element/contact.svg"
            class="h-400px"
            alt=""
            loading="lazy" />
        </div>

        <!-- Contact form START -->
        <div class="col-md-6">
          <div class="row g-4">
            <!-- Title -->
            <h2 class="mt-4 mt-md-0 fs-4">با من در ارتباط باشید</h2>
            <p>
              می تونید سوالات و نظرات و درخواست هاتون رو از طریق این فرم با من
              مطرح کنین
            </p>

            <!-- نمایش پیام‌های خطا -->
            {% if messages %}
            <div class="alert alert-danger">
                <ul class="mb-0">
                    {% for message in messages %}
                    <li>{{ message }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- فرم ارسال پیام -->

            <form
              action="{% url 'contact:contact' %}"
              method="post">
              {% csrf_token %}
              
              <!-- Name -->
              <div class="d-flex">
                <div class="col-md-6 mb-4 m-1 bg-light-input">
                  <label
                    for="yourName"
                    class="form-label"
                    >نام و نام خانوادگی *</label
                  >
                  <input
                    type="text"
                    class="form-control form-control-lg"
                    id="yourName"
                    name="name" />
                </div>

                <div class="col-md-6 mb-4 m-1 bg-light-input">
                  <label
                    for="subjectInput"
                    class="form-label"
                    >عنوان *</label
                  >
                  <input
                    type="text"
                    class="form-control form-control-lg"
                    id="subjectInput"
                    name="subject" />
                </div>
              </div>
              <div class="d-flex">
                <div class="col-md-6 mb-4 m-1 bg-light-input">
                  <label
                    for="emailInput"
                    class="form-label"
                    >ایمیل *</label
                  >
                  <input
                    type="email"
                    class="form-control form-control-lg"
                    id="emailInput"
                    name="email" />
                </div>
                <div class="col-md-6 mb-4 m-1 bg-light-input">
                  <label
                    for="phone_numberInput"
                    class="form-label"
                    >شماره همراه
                  </label>
                  <input
                    type="text"
                    class="form-control form-control-lg"
                    id="phone_numberInput"
                    name="phone" />
                </div>
              </div>
              <!-- Message -->
              <div class="col-md-12 mb-4 m-1 bg-light-input">
                <label
                  for="textareaBox"
                  class="form-label"
                  >متن درخواست *</label
                >
                <textarea
                  class="form-control"
                  id="textareaBox"
                  rows="4"
                  name="message"
                  maxlength="700"
                  oninput="updateCharacterCount()"></textarea>
                <div id="characterCount">0/700</div>
              </div>
              
              <!-- reCAPTCHA -->
              <div class="col-md-12 mb-4 m-1 bg-light-input rounded p-3">
                <label for="id_captcha_1" class="form-label mb-2">کد امنیتی <span class="text-danger">*</span></label>
                <div class="d-flex align-items-center">
                  <!-- تصویر و فیلد کپچا -->
                  <div class="d-flex align-items-center me-1">
                    {{ form.captcha }}
                  </div>
                  <!-- دکمه رفرش -->
                  <button type="button" onclick="refreshCaptcha()" class="btn btn-sm btn-outline-primary captcha-refresh-btn">
                    <i class="fas fa-sync-alt"></i>
                  </button>
                </div>
                <small class="text-muted captcha-help-text d-block mt-1">لطفاً کد نمایش داده شده را وارد کنید</small>
              </div>
              
              <!-- Button -->
              <div class="col-md-12 m-1 d-grid">
                <button
                  class="btn btn-lg btn-primary mb-0"
                  type="submit">
                  ارسال
                </button>
              </div>
            </form>
          </div>
        </div>
        <!-- Contact form END -->
      </div>
    </div>
  </section>
  <!-- =======================
Image and contact form END -->
</main>

<!-- Back to top -->
<div class="back-top">
  <i
    class="fas fa-arrow-up position-absolute top-50 start-50 translate-middle"></i>
</div>

<script src="/static/CACHE/js/output.8d126b85d939.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
  function updateCharacterCount() {
    var textarea = document.getElementById("textareaBox");
    var countElement = document.getElementById("characterCount");

    var enteredCharacters = textarea.value.length;
    var remainingCharacters = textarea.maxLength - enteredCharacters;

    countElement.textContent = enteredCharacters + "/" + remainingCharacters;
  }
  
  function refreshCaptcha() {
    console.log("Refreshing captcha...");
    
    // استفاده از endpoint مخصوص رفرش کپچا
    $.getJSON("/captcha/refresh/", function(result) {
      console.log("Captcha refreshed:", result);
      
      // بروزرسانی تصویر کپچا
      $('.captcha').attr('src', result['image_url']);
      
      // بروزرسانی کلید مخفی کپچا
      $('#id_captcha_0').val(result['key']);
      
      console.log("Updated captcha image and key");
    });
  }
  
  // اجرای کد بعد از بارگذاری صفحه
  $(document).ready(function() {
    // اعمال استایل‌های سفارشی به المان‌های کپچا
    $('#id_captcha_1').addClass('form-control');
    
    // شناسایی و اصلاح ساختار کپچا برای فاصله‌گذاری صحیح
    var captchaTable = $('table.captcha');
    if (captchaTable.length) {
      // اگر کپچا درون جدول قرار دارد
      captchaTable.find('td').css('padding-right', '10px');
    } else {
      // اصلاح مستقیم عناصر کپچا
      if ($('#id_captcha_1').prev().is('img.captcha')) {
        $('#id_captcha_1').css('margin-left', '10px');
      } else {
        // جستجوی تصویر کپچا و اعمال فاصله بیشتر
        $('.captcha').after('<span style="display: inline-block; width: 10px;"></span>');
      }
    }
    
    // استایل دکمه رفرش کپچا
    $('.captcha-refresh-btn').css({
      'border-radius': '50%',
      'width': '38px',
      'height': '38px',
      'margin-right': '0px',
      'margin-left': '0px',
      'padding': '0',
      'display': 'inline-flex',
      'align-items': 'center',
      'justify-content': 'center',
      'font-size': '0.9rem',
      'vertical-align': 'middle',
      'box-shadow': '0 2px 4px rgba(0,0,0,0.1)',
      'border': 'none',
      'transition': 'all 0.2s ease-in-out',
      'background-color': '#f8f9fa',
      'color': '#007bff'
    });
    
    // افکت hover برای دکمه رفرش
    $('.captcha-refresh-btn').hover(
      function() {
        $(this).css({
          'transform': 'rotate(30deg) scale(1.1)',
          'background-color': '#007bff',
          'color': 'white'
        });
      },
      function() {
        $(this).css({
          'transform': 'rotate(0) scale(1)',
          'background-color': '#f8f9fa',
          'color': '#007bff'
        });
      }
    );
    
    // مرتب‌سازی فیلد ورودی کپچا
    $('#id_captcha_1').css({
      'max-width': '150px',
      'height': '38px',
      'margin-top': '0',
      'margin-left': '30px',
      'vertical-align': 'middle',
      'border-radius': '8px',
      'box-shadow': 'inset 0 1px 3px rgba(0,0,0,0.1)',
      'border': '1px solid #ced4da',
      'transition': 'all 0.2s ease',
      'padding': '8px 12px'
    });
    
    // افکت focus برای فیلد ورودی
    $('#id_captcha_1').focus(function() {
      $(this).css({
        'border-color': '#80bdff',
        'box-shadow': 'inset 0 1px 3px rgba(0,0,0,0.1), 0 0 0 0.2rem rgba(0,123,255,0.15)'
      });
    }).blur(function() {
      $(this).css({
        'border-color': '#ced4da',
        'box-shadow': 'inset 0 1px 3px rgba(0,0,0,0.1)'
      });
    });
    
    // تنظیم رنگ‌بندی براساس حالت روز/شب
    function setColorMode() {
      // بررسی آیا حالت تاریک فعال است
      const isDarkMode = $('body').hasClass('dark-mode') || 
                        $('html').hasClass('dark-mode') ||
                        window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      
      if (isDarkMode) {
        // حالت تاریک
        $('.captcha').addClass('border border-secondary');
        
        // تغییر رنگ دکمه در حالت تاریک
        $('.captcha-refresh-btn').css({
          'background-color': '#343a40',
          'color': '#80bdff'
        });
        
        // تغییر استایل فیلد ورودی در حالت تاریک
        $('#id_captcha_1').css({
          'background-color': '#343a40',
          'color': '#e9ecef',
          'border-color': '#495057'
        });
        
        // تغییر رنگ متن راهنمای کپچا در حالت تاریک
        $('.captcha-help-text').removeClass('text-muted').attr('style', 'color: #adb5bd !important; font-weight: 400; display: block; margin-top: 0.25rem;');
      } else {
        // حالت روشن
        $('.captcha').removeClass('border border-secondary');
        
        // تغییر رنگ دکمه در حالت روشن
        $('.captcha-refresh-btn').css({
          'background-color': '#f8f9fa',
          'color': '#007bff'
        });
        
        // تغییر استایل فیلد ورودی در حالت روشن
        $('#id_captcha_1').css({
          'background-color': '#fff',
          'color': '#212529',
          'border-color': '#ced4da'
        });
        
        // تغییر رنگ متن راهنمای کپچا در حالت روشن
        $('.captcha-help-text').removeClass('text-muted').attr('style', 'color: #495057 !important; font-weight: 400; display: block; margin-top: 0.25rem;');
      }
    }
    
    // اجرای تابع تنظیم رنگ
    setColorMode();
    
    // گوش دادن به تغییرات حالت روز/شب
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', setColorMode);
    
    // اگر سایت دارای سوئیچ تغییر حالت روز/شب است، این هم اضافه شود
    $('.mode-switch, .dark-mode-switch').on('click', function() {
      setTimeout(setColorMode, 100); // کمی تاخیر برای اعمال تغییرات
    });
  });
</script>

{% endblock %}
